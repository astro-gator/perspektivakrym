<div class="col-12" style="padding-bottom: 5px; display: flex; flex-wrap: wrap;">
    <button type="button" class="btn btn-outline-success recalculate" data-graph="0" style="margin-right: 5px">Пересчитать</button>
    <button type="button" class="btn btn-outline-primary add-plan-pay" data-graph="0" style="margin-right: 5px">Добавить плановый платеж</button>
    <button type="button" class="btn btn-outline-info get-pdf-land" data-graph="0" style="margin-right: 5px">Основной график (ДДУ, земля, доп. лот) - скачать</button>
    <button type="button" class="btn btn-outline-info get-pdf-contract" data-graph="0" style="margin-right: 5px">График по подряду (скачать)</button>
    <button type="button" class="btn btn-primary freeze-all" data-graph="0" title="Заморозить все платежи" style="margin-right: 5px">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-snow2" viewBox="0 0 16 16">
            <path d="M8 16a.5.5 0 0 1-.5-.5v-1.293l-.646.647a.5.5 0 0 1-.707-.708L7.5 12.793v-1.086l-.646.647a.5.5 0 0 1-.707-.708L7.5 10.293V8.866l-1.236.713-.495 1.85a.5.5 0 1 1-.966-.26l.237-.882-.94.542-.496 1.85a.5.5 0 1 1-.966-.26l.237-.882-1.12.646a.5.5 0 0 1-.5-.866l1.12-.646-.884-.237a.5.5 0 1 1 .26-.966l1.848.495.94-.542-.882-.237a.5.5 0 1 1 .258-.966l1.85.495L7 8l-1.236-.713-1.849.495a.5.5 0 1 1-.258-.966l.883-.237-.94-.542-1.85.495a.5.5 0 0 1-.258-.966l.883-.237-1.12-.646a.5.5 0 1 1 .5-.866l1.12.646-.237-.883a.5.5 0 0 1 .966-.258l.495 1.849.94.542-.236-.883a.5.5 0 0 1 .966-.258l.495 1.849 1.236.713V5.707L6.147 4.354a.5.5 0 1 1 .707-.708l.646.647V3.207L6.147 1.854a.5.5 0 1 1 .707-.708l.646.647V.5a.5.5 0 0 1 1 0v1.293l.647-.647a.5.5 0 1 1 .707.708L8.5 3.207v1.086l.647-.647a.5.5 0 1 1 .707.708L8.5 5.707v1.427l1.236-.713.495-1.85a.5.5 0 1 1 .966.26l-.236.882.94-.542.495-1.85a.5.5 0 1 1 .966.26l-.236.882 1.12-.646a.5.5 0 0 1 .5.866l-1.12.646.883.237a.5.5 0 1 1-.26.966l-1.848-.495-.94.542.883.237a.5.5 0 1 1-.26.966l-1.848-.495L9 8l1.236.713 1.849-.495a.5.5 0 0 1 .259.966l-.883.237.94.542 1.849-.495a.5.5 0 0 1 .259.966l-.883.237 1.12.646a.5.5 0 0 1-.5.866l-1.12-.646.236.883a.5.5 0 1 1-.966.258l-.495-1.849-.94-.542.236.883a.5.5 0 0 1-.966.258L9.736 9.58 8.5 8.866v1.427l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647v1.086l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647V15.5a.5.5 0 0 1-.5.5z"/>
        </svg>
    </button>
    <button type="button" class="btn btn-primary freeze-main" data-graph="0" title="Заморозить платежи по основным платежам" style="margin-right: 5px">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-snow2" viewBox="0 0 16 16">
            <path d="M8 16a.5.5 0 0 1-.5-.5v-1.293l-.646.647a.5.5 0 0 1-.707-.708L7.5 12.793v-1.086l-.646.647a.5.5 0 0 1-.707-.708L7.5 10.293V8.866l-1.236.713-.495 1.85a.5.5 0 1 1-.966-.26l.237-.882-.94.542-.496 1.85a.5.5 0 1 1-.966-.26l.237-.882-1.12.646a.5.5 0 0 1-.5-.866l1.12-.646-.884-.237a.5.5 0 1 1 .26-.966l1.848.495.94-.542-.882-.237a.5.5 0 1 1 .258-.966l1.85.495L7 8l-1.236-.713-1.849.495a.5.5 0 1 1-.258-.966l.883-.237-.94-.542-1.85.495a.5.5 0 0 1-.258-.966l.883-.237-1.12-.646a.5.5 0 1 1 .5-.866l1.12.646-.237-.883a.5.5 0 0 1 .966-.258l.495 1.849.94.542-.236-.883a.5.5 0 0 1 .966-.258l.495 1.849 1.236.713V5.707L6.147 4.354a.5.5 0 1 1 .707-.708l.646.647V3.207L6.147 1.854a.5.5 0 1 1 .707-.708l.646.647V.5a.5.5 0 0 1 1 0v1.293l.647-.647a.5.5 0 1 1 .707.708L8.5 3.207v1.086l.647-.647a.5.5 0 1 1 .707.708L8.5 5.707v1.427l1.236-.713.495-1.85a.5.5 0 1 1 .966.26l-.236.882.94-.542.495-1.85a.5.5 0 1 1 .966.26l-.236.882 1.12-.646a.5.5 0 0 1 .5.866l-1.12.646.883.237a.5.5 0 1 1-.26.966l-1.848-.495-.94.542.883.237a.5.5 0 1 1-.26.966l-1.848-.495L9 8l1.236.713 1.849-.495a.5.5 0 0 1 .259.966l-.883.237.94.542 1.849-.495a.5.5 0 0 1 .259.966l-.883.237 1.12.646a.5.5 0 0 1-.5.866l-1.12-.646.236.883a.5.5 0 1 1-.966.258l-.495-1.849-.94-.542.236.883a.5.5 0 0 1-.966.258L9.736 9.58 8.5 8.866v1.427l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647v1.086l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647V15.5a.5.5 0 0 1-.5.5z"/>
        </svg>
    </button>
    <button type="button" class="btn btn-primary freeze-contract" data-graph="0" title="Заморозить платежи по подряду" style="margin-right: 5px">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-snow2" viewBox="0 0 16 16">
            <path d="M8 16a.5.5 0 0 1-.5-.5v-1.293l-.646.647a.5.5 0 0 1-.707-.708L7.5 12.793v-1.086l-.646.647a.5.5 0 0 1-.707-.708L7.5 10.293V8.866l-1.236.713-.495 1.85a.5.5 0 1 1-.966-.26l.237-.882-.94.542-.496 1.85a.5.5 0 1 1-.966-.26l.237-.882-1.12.646a.5.5 0 0 1-.5-.866l1.12-.646-.884-.237a.5.5 0 1 1 .26-.966l1.848.495.94-.542-.882-.237a.5.5 0 1 1 .258-.966l1.85.495L7 8l-1.236-.713-1.849.495a.5.5 0 1 1-.258-.966l.883-.237-.94-.542-1.85.495a.5.5 0 0 1-.258-.966l.883-.237-1.12-.646a.5.5 0 1 1 .5-.866l1.12.646-.237-.883a.5.5 0 0 1 .966-.258l.495 1.849.94.542-.236-.883a.5.5 0 0 1 .966-.258l.495 1.849 1.236.713V5.707L6.147 4.354a.5.5 0 1 1 .707-.708l.646.647V3.207L6.147 1.854a.5.5 0 1 1 .707-.708l.646.647V.5a.5.5 0 0 1 1 0v1.293l.647-.647a.5.5 0 1 1 .707.708L8.5 3.207v1.086l.647-.647a.5.5 0 1 1 .707.708L8.5 5.707v1.427l1.236-.713.495-1.85a.5.5 0 1 1 .966.26l-.236.882.94-.542.495-1.85a.5.5 0 1 1 .966.26l-.236.882 1.12-.646a.5.5 0 0 1 .5.866l-1.12.646.883.237a.5.5 0 1 1-.26.966l-1.848-.495-.94.542.883.237a.5.5 0 1 1-.26.966l-1.848-.495L9 8l1.236.713 1.849-.495a.5.5 0 0 1 .259.966l-.883.237.94.542 1.849-.495a.5.5 0 0 1 .259.966l-.883.237 1.12.646a.5.5 0 0 1-.5.866l-1.12-.646.236.883a.5.5 0 1 1-.966.258l-.495-1.849-.94-.542.236.883a.5.5 0 0 1-.966.258L9.736 9.58 8.5 8.866v1.427l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647v1.086l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647V15.5a.5.5 0 0 1-.5.5z"/>
        </svg>
    </button>
    <button type="button" class="btn btn-danger unfreeze-all" data-graph="0" title="Разморозить все платежи" style="margin-right: 5px">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-snow2" viewBox="0 0 16 16">
            <path d="M8 16a.5.5 0 0 1-.5-.5v-1.293l-.646.647a.5.5 0 0 1-.707-.708L7.5 12.793v-1.086l-.646.647a.5.5 0 0 1-.707-.708L7.5 10.293V8.866l-1.236.713-.495 1.85a.5.5 0 1 1-.966-.26l.237-.882-.94.542-.496 1.85a.5.5 0 1 1-.966-.26l.237-.882-1.12.646a.5.5 0 0 1-.5-.866l1.12-.646-.884-.237a.5.5 0 1 1 .26-.966l1.848.495.94-.542-.882-.237a.5.5 0 1 1 .258-.966l1.85.495L7 8l-1.236-.713-1.849.495a.5.5 0 1 1-.258-.966l.883-.237-.94-.542-1.85.495a.5.5 0 0 1-.258-.966l.883-.237-1.12-.646a.5.5 0 1 1 .5-.866l1.12.646-.237-.883a.5.5 0 0 1 .966-.258l.495 1.849.94.542-.236-.883a.5.5 0 0 1 .966-.258l.495 1.849 1.236.713V5.707L6.147 4.354a.5.5 0 1 1 .707-.708l.646.647V3.207L6.147 1.854a.5.5 0 1 1 .707-.708l.646.647V.5a.5.5 0 0 1 1 0v1.293l.647-.647a.5.5 0 1 1 .707.708L8.5 3.207v1.086l.647-.647a.5.5 0 1 1 .707.708L8.5 5.707v1.427l1.236-.713.495-1.85a.5.5 0 1 1 .966.26l-.236.882.94-.542.495-1.85a.5.5 0 1 1 .966.26l-.236.882 1.12-.646a.5.5 0 0 1 .5.866l-1.12.646.883.237a.5.5 0 1 1-.26.966l-1.848-.495-.94.542.883.237a.5.5 0 1 1-.26.966l-1.848-.495L9 8l1.236.713 1.849-.495a.5.5 0 0 1 .259.966l-.883.237.94.542 1.849-.495a.5.5 0 0 1 .259.966l-.883.237 1.12.646a.5.5 0 0 1-.5.866l-1.12-.646.236.883a.5.5 0 1 1-.966.258l-.495-1.849-.94-.542.236.883a.5.5 0 0 1-.966.258L9.736 9.58 8.5 8.866v1.427l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647v1.086l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647V15.5a.5.5 0 0 1-.5.5z"/>
        </svg>
    </button>
    <button type="button" class="btn btn-danger unfreeze-main" data-graph="0" title="Разморозить платежи по основным платежам" style="margin-right: 5px">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-snow2" viewBox="0 0 16 16">
            <path d="M8 16a.5.5 0 0 1-.5-.5v-1.293l-.646.647a.5.5 0 0 1-.707-.708L7.5 12.793v-1.086l-.646.647a.5.5 0 0 1-.707-.708L7.5 10.293V8.866l-1.236.713-.495 1.85a.5.5 0 1 1-.966-.26l.237-.882-.94.542-.496 1.85a.5.5 0 1 1-.966-.26l.237-.882-1.12.646a.5.5 0 0 1-.5-.866l1.12-.646-.884-.237a.5.5 0 1 1 .26-.966l1.848.495.94-.542-.882-.237a.5.5 0 1 1 .258-.966l1.85.495L7 8l-1.236-.713-1.849.495a.5.5 0 1 1-.258-.966l.883-.237-.94-.542-1.85.495a.5.5 0 0 1-.258-.966l.883-.237-1.12-.646a.5.5 0 1 1 .5-.866l1.12.646-.237-.883a.5.5 0 0 1 .966-.258l.495 1.849.94.542-.236-.883a.5.5 0 0 1 .966-.258l.495 1.849 1.236.713V5.707L6.147 4.354a.5.5 0 1 1 .707-.708l.646.647V3.207L6.147 1.854a.5.5 0 1 1 .707-.708l.646.647V.5a.5.5 0 0 1 1 0v1.293l.647-.647a.5.5 0 1 1 .707.708L8.5 3.207v1.086l.647-.647a.5.5 0 1 1 .707.708L8.5 5.707v1.427l1.236-.713.495-1.85a.5.5 0 1 1 .966.26l-.236.882.94-.542.495-1.85a.5.5 0 1 1 .966.26l-.236.882 1.12-.646a.5.5 0 0 1 .5.866l-1.12.646.883.237a.5.5 0 1 1-.26.966l-1.848-.495-.94.542.883.237a.5.5 0 1 1-.26.966l-1.848-.495L9 8l1.236.713 1.849-.495a.5.5 0 0 1 .259.966l-.883.237.94.542 1.849-.495a.5.5 0 0 1 .259.966l-.883.237 1.12.646a.5.5 0 0 1-.5.866l-1.12-.646.236.883a.5.5 0 1 1-.966.258l-.495-1.849-.94-.542.236.883a.5.5 0 0 1-.966.258L9.736 9.58 8.5 8.866v1.427l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647v1.086l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647V15.5a.5.5 0 0 1-.5.5z"/>
        </svg>
    </button>
    <button type="button" class="btn btn-danger unfreeze-contract" data-graph="0" title="Разморозить платежи по подряду" style="margin-right: 5px">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-snow2" viewBox="0 0 16 16">
            <path d="M8 16a.5.5 0 0 1-.5-.5v-1.293l-.646.647a.5.5 0 0 1-.707-.708L7.5 12.793v-1.086l-.646.647a.5.5 0 0 1-.707-.708L7.5 10.293V8.866l-1.236.713-.495 1.85a.5.5 0 1 1-.966-.26l.237-.882-.94.542-.496 1.85a.5.5 0 1 1-.966-.26l.237-.882-1.12.646a.5.5 0 0 1-.5-.866l1.12-.646-.884-.237a.5.5 0 1 1 .26-.966l1.848.495.94-.542-.882-.237a.5.5 0 1 1 .258-.966l1.85.495L7 8l-1.236-.713-1.849.495a.5.5 0 1 1-.258-.966l.883-.237-.94-.542-1.85.495a.5.5 0 0 1-.258-.966l.883-.237-1.12-.646a.5.5 0 1 1 .5-.866l1.12.646-.237-.883a.5.5 0 0 1 .966-.258l.495 1.849.94.542-.236-.883a.5.5 0 0 1 .966-.258l.495 1.849 1.236.713V5.707L6.147 4.354a.5.5 0 1 1 .707-.708l.646.647V3.207L6.147 1.854a.5.5 0 1 1 .707-.708l.646.647V.5a.5.5 0 0 1 1 0v1.293l.647-.647a.5.5 0 1 1 .707.708L8.5 3.207v1.086l.647-.647a.5.5 0 1 1 .707.708L8.5 5.707v1.427l1.236-.713.495-1.85a.5.5 0 1 1 .966.26l-.236.882.94-.542.495-1.85a.5.5 0 1 1 .966.26l-.236.882 1.12-.646a.5.5 0 0 1 .5.866l-1.12.646.883.237a.5.5 0 1 1-.26.966l-1.848-.495-.94.542.883.237a.5.5 0 1 1-.26.966l-1.848-.495L9 8l1.236.713 1.849-.495a.5.5 0 0 1 .259.966l-.883.237.94.542 1.849-.495a.5.5 0 0 1 .259.966l-.883.237 1.12.646a.5.5 0 0 1-.5.866l-1.12-.646.236.883a.5.5 0 1 1-.966.258l-.495-1.849-.94-.542.236.883a.5.5 0 0 1-.966.258L9.736 9.58 8.5 8.866v1.427l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647v1.086l1.354 1.353a.5.5 0 0 1-.707.708l-.647-.647V15.5a.5.5 0 0 1-.5.5z"/>
        </svg>
    </button>
    <form action="{{route('perspektivakrym_perspektivakrym_get_general_pdf')}}" method="POST" style="margin-right: 5px">
        @csrf
        <input type="hidden" name="deal_id" value="{{ $viewData['dealId'] }}">
        <input type="hidden" name="auth" value="{{ $viewData['auth'] }}">
        <input type="hidden" name="number_graph" value="0">
        <button type="submit" class="btn btn-danger get-pdf-general" title="Разморозить платежи по подряду">
            Скачать рассрочку
        </button>
    </form>
    <form action="{{route('perspektivakrym_perspektivakrym_get_excel_for_lawyer')}}" method="POST" style="margin-right: 5px">
        @csrf
        <input type="hidden" name="deal_id" value="{{ $viewData['dealId'] }}">
        <input type="hidden" name="auth" value="{{ $viewData['auth'] }}">
        <input type="hidden" name="type" value="general">
        <input type="hidden" name="number_graph" value="0">
        <button type="submit" class="btn btn-light get-pdf-general" title="Скачать график для нотариуса по земле" style="margin-right: 5px">
            Нотариус Земля
        </button>
    </form>
    <form action="{{route('perspektivakrym_perspektivakrym_get_excel_for_lawyer')}}" method="POST">
        @csrf
        <input type="hidden" name="deal_id" value="{{ $viewData['dealId'] }}">
        <input type="hidden" name="auth" value="{{ $viewData['auth'] }}">
        <input type="hidden" name="type" value="land">
        <input type="hidden" name="number_graph" value="0">
        <button type="submit" class="btn btn-light get-pdf-general" title="Скачать график для нотариуса по подряду" style="margin-right: 5px">
             Подряд XLS
        </button>
    </form>
</div>

<?php $totalAmountMain = 0?>
<?php $totalAmountContract = 0 ?>

<div class="col-12">
    <div class="table-responsive">
        <table class="table table-sm table-striped sortable-table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Заморожен</th>
                    <th scope="col">Тип платежа</th>
                    <th scope="col">Сумма планового платежа</th>
                    <th scope="col">Дата планового платежа</th>
                    <th scope="col">Сумма фактического платежа</th>
                    <th scope="col">Просрочка, дней</th>
                    <th scope="col">Комментарий</th>
                    <th scope="col">Номер договора</th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                @php $i = 1; @endphp
                @foreach($viewData['resultMainPayments'] as $payment)
                    <?php $totalAmountMain = $totalAmountMain + $payment['amount']?>
                    @php if($payment['amount'] !== 0){ @endphp
                        <tr>
                            <td>{{ $i }}</td>
                            <td>
                                <input
                                    type="checkbox"
                                    class="payment__block {{ ($payment['pay_type'] === 'down_payment' && $payment['add_type'] === 'auto')? 'not-edit' : '' }} {{ ($payment['blocked'])? 'blocked' : '' }}"
                                    {{ ($payment['blocked'])? 'checked' : '' }}
                                    data-id = "{{ $payment['id'] }}"
                                    name="payment-block"
                                >
                            </td>
                            <td>
                                <?php
                                    switch ($payment['pay_type']) {
                                        case 'down_payment':
                                            echo 'ПВ ' . '<small class="form-text text-muted">(' . $payment['add_type'] . ')</small>';
                                            break;
                                        case 'regular_payment':
                                            echo 'Регулярный платеж';
                                            break;
                                    }
                                ?>
                            </td>

                            <td
                                class="plan-amount {{ ($payment['blocked'])? 'blocked' : '' }}"
                                data-id = {{ $payment['id'] }}
                            >
                                <strong>{{ number_format($payment['amount'], 2, '.', ' ') }}</strong>
                                <form method="POST" action="{{ route('perspektivakrym_perspektivakrym-planAmount') }}" style="display: none">
                                    <input type="hidden" name="deal_id" value="{{ $viewData['dealId'] }}">
                                    <input type="hidden" name="auth" value="{{ $viewData['auth'] }}">
                                    <input type="hidden" name="operation_id" value="{{ $payment['id'] }}">
                                    <input type="number" min="0" class="form-control" value="{{ $payment['amount'] }}" name="amount" autocomplete="off">
                                </form>
                            </td>
                            <td
                                class="plan__date {{ ($payment['blocked'])? 'blocked' : '' }}"
                                data-id = "{{ $payment['id'] }}"
                                data-date = "{{ date('d.m.Y', strtotime($payment['date'])) }}"
                                data-is_text_date = "{{ $payment['is_text_date'] }}"
                                data-text_date = "{{ $payment['text_date'] }}"
                            >
                                <strong id="plan_date_{{ $payment['id'] }}">{{ ($payment['is_text_date'])? $payment['text_date'] : date('d.m.Y', strtotime($payment['date'])) }}</strong>
                            </td>
                            <td><strong>{{ number_format($payment['amount_fact'], 2, '.', ' ') }}</strong></td>
                            <td>{{ $payment['diff'] }}</td>
                            <td
                                class="comment {{ ($payment['blocked'])? 'blocked' : '' }}"
                                data-id = "{{ $payment['id'] }}"
                                data-value = "{{ $payment['note'] }}"
                            >
                                {{ $payment['note'] }}
                            </td>
                            <td style="font-size: 10px">{{ $payment['doc_number'] }}</td>
                            <td>
                                <button class="
                                    btn
                                    btn-danger
                                    delete-plan-pay
                                    {{ ($payment['blocked'])? 'blocked' : '' }}
                                "
                                        data-id="{{ $payment['id'] }}"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                        <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        @php $i++ @endphp
                    @php } @endphp
                @endforeach
                <tr>
                    <td colspan="9" style="text-align: right">
                        <strong>Итого: {{ number_format($totalAmountMain, 2, '.', ' ') }}</strong>
                    </td>
                </tr>
                <tr style="background-color: black">
                    <td colspan="10" style="background-color: black"></td>
                </tr>
                @foreach($viewData['resultContractorPayments'] as $payment)
                    <?php $totalAmountContract = $totalAmountContract + $payment['amount']?>
                    @php if ($payment['amount'] !== 0) { @endphp
                        <tr>
                            <td>{{ $i }}</td>
                            <td>
                                <input
                                    type="checkbox"
                                    class="payment__block {{ ($payment['pay_type'] === 'down_payment' && $payment['add_type'] === 'auto')? 'not-edit' : '' }} {{ ($payment['blocked'])? 'blocked' : '' }}"
                                    {{ ($payment['blocked'])? 'checked' : '' }}
                                    data-id = "{{ $payment['id'] }}"
                                    name="payment-block"
                                >
                            </td>
                            <td>
                                <?php
                                switch ($payment['pay_type']) {
                                    case 'down_payment':
                                        echo 'ПВ' . '<small class="form-text text-muted">(' . $payment['add_type'] . ')</small>';
                                        break;
                                    case 'regular_payment':
                                        echo 'Регулярный платеж';
                                        break;
                                }
                                ?>
                            </td>

                            <td
                                class="plan-amount {{ ($payment['blocked'])? 'blocked' : '' }}"
                                data-id = {{ $payment['id'] }}
                            >
                                <strong>{{ number_format($payment['amount'], 2, '.', ' ') }}</strong>
                                <form method="POST" action="{{ route('perspektivakrym_perspektivakrym-planAmount') }}" style="display: none">
                                    <input type="hidden" name="deal_id" value="{{ $viewData['dealId'] }}">
                                    <input type="hidden" name="auth" value="{{ $viewData['auth'] }}">
                                    <input type="hidden" name="operation_id" value="{{ $payment['id'] }}">
                                    <input type="number" min="0" class="form-control" value="{{ $payment['amount'] }}" name="amount" autocomplete="off">
                                </form>
                            </td>
                            <td
                                class="plan__date {{ ($payment['blocked'])? 'blocked' : '' }}"
                                data-id = "{{ $payment['id'] }}"
                                data-date = "{{ date('d.m.Y', strtotime($payment['date'])) }}"
                                data-is_text_date = "{{ $payment['is_text_date'] }}"
                                data-text_date = "{{ $payment['text_date'] }}"
                            >
                                <strong id="plan_date_{{ $payment['id'] }}">{{ ($payment['is_text_date'])? $payment['text_date'] : date('d.m.Y', strtotime($payment['date'])) }}</strong>
                            </td>
                            <td>
                                <strong>{{ number_format($payment['amount_fact'], 2, '.', ' ') }}</strong>

                            </td>
                            <td>{{ $payment['diff'] }}</td>
                            <td
                                class="comment {{ ($payment['blocked'])? 'blocked' : '' }}"
                                data-id = "{{ $payment['id'] }}"
                                data-value = "{{ $payment['note'] }}"
                            >
                                {{ $payment['note'] }}
                            </td>
                            <td style="font-size: 10px">{{ $payment['doc_number'] }}</td>
                            <td>
                                <button class="
                                    btn
                                    btn-danger
                                    delete-plan-pay
                                    {{ ($payment['blocked'])? 'blocked' : '' }}
                                    "
                                        data-id="{{ $payment['id'] }}"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
                                        <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
                                        <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                        @php $i++ @endphp
                    @php } @endphp
                @endforeach
                <tr>
                    <td colspan="9" style="text-align: right">
                        <strong>Итого: {{ number_format($totalAmountContract, 2, '.', ' ') }}</strong>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

{{--                            <div class="d-flex">--}}
{{--                                --}}{{--                @if($block_access)--}}
{{--                                @if($payments[0]['blocked'] == 0)--}}
{{--                                    <form action="{{ route('perspektivakrym_perspektivakrym_recalculatePayments') }}" method="POST">--}}
{{--                                        @csrf--}}
{{--                                        <input type="hidden" name="deal_id" value="{{ $viewData['dealId'] }}">--}}
{{--                                        <input type="hidden" name="auth" value="{{ $viewData['auth'] }}">--}}
{{--                                        <button type="submit" class="btn btn-outline-success">Пересчитать</button>--}}
{{--                                    </form>--}}
{{--                                    &nbsp;--}}
{{--                                    <form action="{{ route('perspektivakrym_perspektivakrym_block') }}" method="POST">--}}
{{--                                        @csrf--}}
{{--                                        <input type="hidden" name="deal_id" value="{{ $viewData['dealId'] }}">--}}
{{--                                        <input type="hidden" name="auth" value="{{ $viewData['auth'] }}">--}}
{{--                                        <button type="submit" class="btn btn-outline-danger">Заморозить</button>--}}
{{--                                    </form>--}}

{{--                                @else--}}

{{--                                    <form action="{{ route('perspektivakrym_perspektivakrym_unblock') }}" method="POST">--}}
{{--                                        @csrf--}}
{{--                                        <input type="hidden" name="deal_id" value="{{ $viewData['dealId'] }}">--}}
{{--                                        <input type="hidden" name="auth" value="{{ $viewData['auth'] }}">--}}
{{--                                        <button type="submit" class="btn btn-outline-success">Разморозить</button>--}}
{{--                                    </form>--}}

{{--                                @endif--}}
{{--                                --}}{{--                @endif--}}
{{--                                &nbsp;--}}
{{--                                <button type="button" class="btn btn-outline-info" data-toggle="modal" data-target="#getPdfContract">График по подряду (скачать)</button>--}}
{{--                                &nbsp;--}}
{{--                                <button type="button" class="btn btn-outline-info" data-toggle="modal" data-target="#getPdfLand">Основной график (ДДУ, земля, доп. лот) - скачать</button>--}}
{{--                                &nbsp;--}}
{{--                                <form action="{{ route('perspektivakrym_perspektivakrym_getPayment') }}" method="POST">--}}
{{--                                    @csrf--}}
{{--                                    <input type="hidden" name="deal_id" value="{{ $viewData['dealId'] }}">--}}
{{--                                    <input type="hidden" name="auth" value="{{ $viewData['auth'] }}">--}}
{{--                                    <button type="submit" class="btn btn-outline-secondary">Синхронизировать платежи</button>--}}
{{--                                </form>--}}
{{--                            </div>--}}

{{--                            <table class="table table-bordered">--}}
{{--                                <thead>--}}
{{--                                <td>№ Договора</td>--}}
{{--                                <td>№ платежа</td>--}}
{{--                                <td>План сумма</td>--}}
{{--                                <td>Факт сумма</td>--}}
{{--                                <td>План Дата</td>--}}
{{--                                <td>Факт Дата</td>--}}
{{--                                <td>Просрочка, дн.</td>--}}
{{--                                </thead>--}}

{{--                                <tbody>--}}
{{--                                @foreach($payments as $p)--}}
{{--                                    <tr>--}}
{{--                                        <td class="table__row">{{ $p['doc_number'] }}</td>--}}
{{--                                        <td class="table__row">{{ $p['number'] }}</td>--}}
{{--                                        <td class="table__row table__row_plan-amount" data-deal="{{ $p['deal'] }}" data-change="{{ $p['change'] }}" data-id="{{ $p['id'] }}">{{ $p['plan_amount'] }}</td>--}}
{{--                                        <td class="table__row table__row_fact-amount" data-deal="{{ $p['deal'] }}" data-change="{{ $p['change'] }}" data-id="{{ $p['id'] }}">{{ $p['fact_amount'] }}</td>--}}
{{--                                        <td class="table__row table__row_plan-date" data-deal="{{ $p['deal'] }}" data-change="{{ $p['change'] }}" data-id="{{ $p['id'] }}">--}}
{{--                                            {{ date('d.m.Y', strtotime($p['plan_date'])) }}--}}
{{--                                        </td>--}}
{{--                                        <td class="table__row">{{ (is_null($p['fact_date']))? '' : date('d.m.Y', strtotime($p['fact_date'])) }}</td>--}}
{{--                                        <td class="table__row">{{ $p['diff_days'] }}</td>--}}
{{--                                    </tr>--}}
{{--                                @endforeach--}}
{{--                                </tbody>--}}
{{--                            </table>--}}

